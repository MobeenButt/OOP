using System;

namespace RailwaySystem
{
    class RailwaySystem
    {
        static void Main(string[] args)
        {
            UserManagement userManagement = new UserManagement();
            userManagement.LoadUserRecords();
            userManagement.SaveUserRecords();
            int option;

            while (true)
            {
                Console.WriteLine("\t\t1. SignIn");
                Console.WriteLine("\t\t2. SignUp");
                Console.WriteLine("\t\t3. Exit");
                Console.WriteLine("\t\tEnter your option...");

                string input = Console.ReadLine();
                if (int.TryParse(input, out option))
                {
                    if (option >= 1 && option <= 3)
                    {
                        if (option == 1)
                        {
                            Console.Write("Enter Name: ");
                            string name = Console.ReadLine();
                            Console.Write("Enter your Password: ");
                            string password = ReadPassword();
                            string role = userManagement.SignIn(name, password);
                            Console.WriteLine($"User role: {role}");
                        }
                        else if (option == 2)
                        {
                            Console.Write("Enter Name: ");
                            string signUpName = Console.ReadLine();
                            Console.Write("Enter your Password: ");
                            string signUpPassword = ReadPassword();
                            Console.Write("Enter Role: ");
                            string signUpRole = Console.ReadLine();

                            bool signUpResult = userManagement.SignUp(signUpName, signUpPassword, signUpRole);
                            if (signUpResult)
                            {
                                Console.WriteLine("User registered successfully.");
                                userManagement.SaveUserRecords();
                            }
                            else
                            {
                                Console.WriteLine("Username already exists or maximum users reached. Signup failed.");
                            }
                        }
                        else if (option == 3)
                        {
                            Console.WriteLine("Exiting the program. Goodbye!");
                            break;
                        }
                    }
                    else
                    {
                        Console.WriteLine("Invalid option. Please enter a valid number (1-3).");
                    }
                }
                else
                {
                    Console.WriteLine("Invalid input. Please enter a valid number (1-3).");
                }
            }
        }


        static string ReadPassword()
        {
            string password = "";
            ConsoleKeyInfo key = Console.ReadKey(true);

            while (key.Key != ConsoleKey.Enter)
            {
                password += key.KeyChar;
                Console.Write("*");
                key = Console.ReadKey(true);
            }

            Console.WriteLine();
            return password;
        }


    }
}
